# Python package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- master

pool: nvidia-pool

container:
  image: pytorch/pytorch:1.6.0-cuda10.1-cudnn7-runtime
  options: --gpus all

steps:

- bash: |
    whereis nvidia
    nvidia-smi
    python --version
    pip --version
    pip list
  displayName: 'Image info & NVIDIA'

- script: |
    python -m pip install --upgrade pip
    pip install .[all]
  displayName: 'Install dependencies'

- script: |
    pytest -v --device cuda --dtype float32,float64 ./test
  displayName: 'pytest'
